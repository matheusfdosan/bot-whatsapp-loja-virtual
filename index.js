// By Matheus Faustino
const qrcode = require("qrcode-terminal")

const { Client, LocalAuth } = require("whatsapp-web.js")
const client = new Client({
  authStrategy: new LocalAuth({
    dataPath: "whatsapp-auth",
  }),
})

client.on("qr", (qr) => {
  qrcode.generate(qr, { small: true })
  console.log("Fa√ßa conex√£o com o seu Whatsapp via QrCode")
})

client.on("ready", () => {
  console.log("Cliente conectado com sucesso!")
})

client.on("disconnected", (reason) => {
  console.log("Cliente desconectado. Motivo: ", reason)
})

client.on("auth_failure", () => {
  console.log("Falha na autentica√ß√£o. Verifique o QR code ou sess√£o.")
})

let botState = "menu"
let shop_cart = []
let shop_cart_prices = []
let shop_cart_price = 0

function showMenu() {
  return `*Loja Virtual*: üëã Ol√°, seja bem-vindo √† nossa Loja Virtual! üéâ
Estamos aqui para ajudar voc√™ a encontrar os produtos que deseja de maneira r√°pida e pr√°tica.
    
Escolha uma das op√ß√µes abaixo para come√ßar:
    
1Ô∏è‚É£ Ver Cat√°logo de Produtos
2Ô∏è‚É£ Ver meu Carrinho de Compras
3Ô∏è‚É£ Finalizar Compra com Pix

Digite o n√∫mero da op√ß√£o ou escreva "!fecharloja" para finalizar o atendimento!`
}

function showCatalog() {
  return `*Loja Virtual*: üõçÔ∏è √ìtima escolha! Vamos explorar nosso cat√°logo de produtos.

Aqui est√£o algumas categorias para voc√™ escolher:

1Ô∏è‚É£ Roupas e Acess√≥rios
2Ô∏è‚É£ Tecnologia e Gadgets
3Ô∏è‚É£ Casa e Decora√ß√£o

Digite o n√∫mero da categoria que voc√™ deseja explorar, ou se preferir, digite "voltar"para retornar ao menu! üòä`
}

client.on("message_create", (message) => {
  // ----------------------- MENU -----------------------
  if (botState === "menu" && message.body === "!loja") {
    message.reply(showMenu())
    console.log("Store Open!")
    return
  }

  if (botState === "menu" && message.body === "1") {
    message.reply(showCatalog())
    botState = "catalog"
    return
  } else if (botState === "menu" && message.body === "2") {
    if (shop_cart.length === 0) {
      message.reply(`Seu carrinho est√° vazio.

1Ô∏è‚É£ Voltar para o menu`)
    } else if (shop_cart.length > 0) {
      message.reply(`*Loja Virtual*: üõí Seu Carrinho de Compras

Aqui est√£o os itens que voc√™ adicionou ao carrinho:

${shop_cart.map((p, i) => `*Produto ${i + 1}*: ${p}`).join("\n\n")}

Total: R$ ${shop_cart_prices.reduce(
        (accumulator, currentValue) => accumulator + currentValue,
        shop_cart_price
      )}
      
üëâ Digite "limpar" para tirar todos os itens do carrinho ou digite "voltar" para retornar ao menu.`)
    }

    botState = "shopping_cart"
    return
  } else if (botState === "menu" && message.body === "3") {
    message.reply(`Bot:
üí≥ Finalizar Compra com Pix üí∏

Aqui est√° o resumo do seu pedido:

${shop_cart.map((p, i) => `*Produto ${i + 1}*: ${p}`).join("\n\n")}

Pre√ßo: R$ ${shop_cart_prices.reduce(
      (accumulator, currentValue) => accumulator + currentValue,
      shop_cart_price
    )}

Para realizar o pagamento via Pix, siga os passos abaixo:

1Ô∏è‚É£ Copie e cole esta chave Pix no app: email.ficticio@pix.com.br
2Ô∏è‚É£ Voltar ao menu

Ap√≥s o pagamento, envie o comprovante aqui no chat para confirmarmos o seu pedido. üì©

üöö Assim que confirmado, enviaremos a atualiza√ß√£o do status do seu pedido. Obrigado por comprar conosco! üòä`)
    botState = "finalize_purchase"
    return
  }

  // ----------------------- CATALOG -----------------------
  if (botState === "catalog" && message.body === "1") {
    message.reply(`*Loja Virtual*: üëó Roupas e Acess√≥rios üëï

Aqui est√£o alguns itens que voc√™ pode gostar:

1Ô∏è‚É£ Camiseta B√°sica Unissex
Pre√ßo: R$ 49,90
Descri√ß√£o: Dispon√≠vel em v√°rias cores e tamanhos. Feita com algod√£o premium.

2Ô∏è‚É£ Jaqueta Jeans Oversized
Pre√ßo: R$ 159,90
Descri√ß√£o: Um cl√°ssico atemporal, dispon√≠vel nos tamanhos P, M, G e GG.

3Ô∏è‚É£ Rel√≥gio Minimalista
Pre√ßo: R$ 199,90
Descri√ß√£o: Design moderno com pulseira de couro ajust√°vel.

4Ô∏è‚É£ Mochila Casual
Pre√ßo: R$ 129,90
Descri√ß√£o: Espa√ßosa e resistente, ideal para o dia a dia.

5Ô∏è‚É£ √ìculos de Sol Vintage
Pre√ßo: R$ 89,90
Descri√ß√£o: Estilo retr√¥ com prote√ß√£o UV400.

üëâ Digite o n√∫mero do item para adicion√°-lo ao seu carrinho ou escreva "voltar" para retornar ao menu anterior. üòä`)
    botState = "clothes_accessories"
    return
  } else if (botState === "catalog" && message.body === "2") {
    message.reply(`*Loja Virtual*: üì± Tecnologia e Gadgets üíª
    
Aqui est√£o algumas op√ß√µes incr√≠veis para voc√™ explorar:

1Ô∏è‚É£ Fone de Ouvido Bluetooth
Pre√ßo: R$ 129,90
Descri√ß√£o: Som de alta qualidade, bateria de longa dura√ß√£o e compatibilidade universal.

2Ô∏è‚É£ Carregador Port√°til (Power Bank)
Pre√ßo: R$ 179,90
Descri√ß√£o: Capacidade de 20.000 mAh, ideal para recarregar seus dispositivos em qualquer lugar.

3Ô∏è‚É£ Smartwatch Esportivo
Pre√ßo: R$ 299,90
Descri√ß√£o: Monitoramento de atividades f√≠sicas, batimentos card√≠acos e notifica√ß√µes do celular.

4Ô∏è‚É£ Teclado Mec√¢nico RGB
Pre√ßo: R$ 249,90
Descri√ß√£o: Ideal para gamers, com ilumina√ß√£o personaliz√°vel e teclas super responsivas.

5Ô∏è‚É£ C√¢mera de Seguran√ßa Wi-Fi
Pre√ßo: R$ 199,90
Descri√ß√£o: Transmiss√£o ao vivo, vis√£o noturna e acesso remoto via app.

üëâ Digite o n√∫mero do item para adicion√°-lo ao seu carrinho ou escreva "voltar" para retornar ao menu anterior.`)
    botState = "tech_gadgets"
    return
  } else if (botState === "catalog" && message.body === "3") {
    message.reply(`*Loja Virtual*: üè† Casa e Decora√ß√£o üïØÔ∏è

Deixe sua casa mais bonita e aconchegante com esses produtos:


1Ô∏è‚É£ Kit de Velas Arom√°ticas
Pre√ßo: R$ 89,90
Descri√ß√£o: Conjunto com 3 velas de aromas diferentes, perfeitas para criar um ambiente relaxante.

2Ô∏è‚É£ Jogo de Cama 4 Pe√ßas - Queen
Pre√ßo: R$ 229,90
Descri√ß√£o: Len√ßol com el√°stico, sobrelen√ßol e duas fronhas, feito com algod√£o 100%.

3Ô∏è‚É£ Lumin√°ria LED de Mesa
Pre√ßo: R$ 149,90
Descri√ß√£o: Design moderno com ajuste de intensidade de luz e entrada USB para recarga.

4Ô∏è‚É£ Quadros Decorativos - Kit com 3 Pe√ßas
Pre√ßo: R$ 199,90
Descri√ß√£o: Estampas minimalistas que combinam com qualquer ambiente.

5Ô∏è‚É£ Tapete de Pel√∫cia Antiderrapante
Pre√ßo: R$ 179,90
Descri√ß√£o: Ideal para salas e quartos, com toque macio e base segura.

üëâ Digite o n√∫mero do item para adicion√°-lo ao seu carrinho ou escreva "voltar" para retornar ao menu anterior.`)
    botState = "home_decoration"
    return
  } else if (
    botState === "catalog" &&
    (message.body === "voltar" || message.body === "Voltar")
  ) {
    message.reply(`‚¨Ö Voltando ao menu... Voc√™ est√° no menu!`)
    botState = "menu"
    message.reply(showMenu())
    return
  }

  // ----------------------- SHOPPING CART -----------------------
  if (botState === "shopping_cart" && message.body === "limpar") {
    message.reply(`üõí Carrinho de compras limpo! üßº

‚¨Ö Voltando ao menu... Voc√™ est√° no menu!
    `)
    botState = "menu"
    shop_cart = []
    shop_cart_prices = []
    shop_cart_price = 0
    return
  } else if (botState === "shopping_cart" && message.body === "1") {
    message.reply(`‚¨Ö Voltando ao menu... Voc√™ est√° no menu!`)
    botState = "menu"
    message.reply(showMenu())
    return
  } else if (
    botState === "shopping_cart" &&
    (message.body === "voltar" || message.body === "Voltar")
  ) {
    message.reply(`‚¨Ö Voltando para ao menu... Voc√™ est√° no menu!`)
    botState = "menu"
    message.reply(showMenu())
  }

  // ----------------------- FINALIZE PURCHASE -----------------------
  if (botState === "finalize_purchase" && message.body === "1") {
    message.reply(
      `email.ficticio@pix.com.br\n\n‚úÖ Compra realizada com sucesso!`
    )
    const timestamp = new Date().getTime()
    const formattedDate = new Date(timestamp).toLocaleString()
    console.log(
      `Purchase Made: R$${shop_cart_prices.reduce(
        (accumulator, currentValue) => accumulator + currentValue,
        shop_cart_price
      )} at ${formattedDate} `
    )
    shop_cart = []
    shop_cart_prices = []
    shop_cart_price = 0
    setTimeout(() => {
      message.reply(`‚¨Ö Voltando para o menu... Voc√™ est√° no menu!`)
      botState = "menu"
      message.reply(showMenu())
    }, 3000)
    return
  } else if (botState === "finalize_purchase" && message.body === "2") {
    message.reply(`‚¨Ö Voltando para o menu... Voc√™ est√° no menu!`)
    botState = "menu"
    message.reply(showMenu())
    return
  }

  // ----------------------- CATALOG 1 - CLOTHES AND ACESSORIES -----------------------
  if (botState === "clothes_accessories" && message.body === "1") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Camiseta B√°sica Unissex - *R$ 49,90* - Dispon√≠vel em v√°rias cores e tamanhos. Feita com algod√£o premium.`
    )
    shop_cart.push("Camiseta B√°sica Unissex - *R$ 49,90*")
    shop_cart_prices.push(49.9)
    return
  } else if (botState === "clothes_accessories" && message.body === "2") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Jaqueta Jeans Oversized - *R$ 159,90* - Um cl√°ssico atemporal, dispon√≠vel nos tamanhos P, M, G e GG.`
    )
    shop_cart.push("Jaqueta Jeans Oversized - *R$ 159,90*")
    shop_cart_prices.push(159.9)
    return
  } else if (botState === "clothes_accessories" && message.body === "3") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Rel√≥gio Minimalista - *R$ 199,90* - Design moderno com pulseira de couro ajust√°vel.`
    )
    shop_cart.push("Rel√≥gio Minimalista - *R$ 199,90*")
    shop_cart_prices.push(199.9)

    return
  } else if (botState === "clothes_accessories" && message.body === "4") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Mochila Casual - *R$ 129,90* - Espa√ßosa e resistente, ideal para o dia a dia.`
    )
    shop_cart.push("Mochila Casual - *R$ 129,90*")
    shop_cart_prices.push(129.9)
    return
  } else if (botState === "clothes_accessories" && message.body === "5") {
    message.reply(
      `Foi adicionado ao carrinho o produto: √ìculos de Sol Vintage - *R$ 89,90* - Estilo retr√¥ com prote√ß√£o UV400.`
    )
    shop_cart.push("√ìculos de Sol Vintage - *R$ 89,90*")
    shop_cart_prices.push(89.9)
    return
  } else if (
    botState === "clothes_accessories" &&
    (message.body === "voltar" || message.body === "Voltar")
  ) {
    message.reply(`‚¨Ö Voltando para o cat√°logo... Voc√™ est√° no cat√°logo!`)
    botState = "catalog"
    message.reply(showCatalog())
  }

  // ----------------------- CATALOG 2 - TEHCNOLOGY AND GADGETS -----------------------
  if (botState === "tech_gadgets" && message.body === "1") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Fone de Ouvido Bluetooth - *R$ 129,90* - Som de alta qualidade, bateria de longa dura√ß√£o e compatibilidade universal.`
    )
    shop_cart.push("Fone de Ouvido Bluetooth - *R$ 129,90*")
    shop_cart_prices.push(129.9)
    return
  } else if (botState === "tech_gadgets" && message.body === "2") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Carregador Port√°til (Power Bank) - *R$ 179,90* - Capacidade de 20.000 mAh, ideal para recarregar seus dispositivos em qualquer lugar.`
    )
    shop_cart.push("Carregador Port√°til (Power Bank) - *R$ 179,90*")
    shop_cart_prices.push(179.9)
    return
  } else if (botState === "tech_gadgets" && message.body === "3") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Smartwatch Esportivo - *R$ 299,90* - Monitoramento de atividades f√≠sicas, batimentos card√≠acos e notifica√ß√µes do celular.`
    )
    shop_cart.push("Smartwatch Esportivo - *R$ 299,90*")
    shop_cart_prices.push(299.9)
    return
  } else if (botState === "tech_gadgets" && message.body === "4") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Teclado Mec√¢nico RGB - *R$ 249,90* - Ideal para gamers, com ilumina√ß√£o personaliz√°vel e teclas super responsivas.`
    )
    shop_cart.push("Teclado Mec√¢nico RGB - *R$ 249,90*")
    shop_cart_prices.push(249.9)
    return
  } else if (botState === "tech_gadgets" && message.body === "5") {
    message.reply(
      `Foi adicionado ao carrinho o produto: C√¢mera de Seguran√ßa Wi-Fi - *R$ 199,90* - Transmiss√£o ao vivo, vis√£o noturna e acesso remoto via app.`
    )
    shop_cart.push("C√¢mera de Seguran√ßa Wi-Fi - *R$ 199,90*")
    shop_cart_prices.push(199.9)
    return
  } else if (
    botState === "tech_gadgets" &&
    (message.body === "voltar" || message.body === "Voltar")
  ) {
    message.reply(`‚¨Ö Voltando para o cat√°logo... Voc√™ est√° no cat√°logo!`)
    botState = "catalog"
    message.reply(showCatalog())
  }

  // ----------------------- CATALOG 3 - HOME AND DECORATIONS -------------------------
  if (botState === "home_decoration" && message.body === "1") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Kit de Velas Arom√°ticas - *R$ 89,90* - Conjunto com 3 velas de aromas diferentes, perfeitas para criar um ambiente relaxante.`
    )
    shop_cart.push("Kit de Velas Arom√°ticas - *R$ 89,90*")
    shop_cart_prices.push(89.9)
    return
  } else if (botState === "home_decoration" && message.body === "2") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Jogo de Cama 4 Pe√ßas - Queen - *R$ 229,90* - Len√ßol com el√°stico, sobrelen√ßol e duas fronhas, feito com algod√£o 100%.`
    )
    shop_cart.push("Jogo de Cama 4 Pe√ßas - Queen - *R$ 229,90*")
    shop_cart_prices.push(229.9)
    return
  } else if (botState === "home_decoration" && message.body === "3") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Lumin√°ria LED de Mesa - *R$ 149,90* - Design moderno com ajuste de intensidade de luz e entrada USB para recarga.`
    )
    shop_cart.push("Lumin√°ria LED de Mesa - *R$ 149,90*")
    shop_cart_prices.push(149.9)
    return
  } else if (botState === "home_decoration" && message.body === "4") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Quadros Decorativos - Kit com 3 Pe√ßas - *R$ 199,90* - Estampas minimalistas que combinam com qualquer ambiente.`
    )
    shop_cart.push("Quadros Decorativos - Kit com 3 Pe√ßas - *R$ 199,90*")
    shop_cart_prices.push(199.9)
    return
  } else if (botState === "home_decoration" && message.body === "5") {
    message.reply(
      `Foi adicionado ao carrinho o produto: Tapete de Pel√∫cia Antiderrapante - *R$ 179,90* - Ideal para salas e quartos, com toque macio e base segura.`
    )
    shop_cart.push("Tapete de Pel√∫cia Antiderrapante - *R$ 179,90*")
    shop_cart_prices.push(179.9)
    return
  } else if (
    botState === "home_decoration" &&
    (message.body === "voltar" || message.body === "Voltar")
  ) {
    message.reply(`‚¨Ö Voltando para o cat√°logo... Voc√™ est√° no cat√°logo!`)
    botState = "catalog"
    message.reply(showCatalog())
  }

  // ----------------------- CLOSE STORE -----------------------
  if (message.body === "!fecharloja") {
    message.reply(`*Loja Virtual*: üëã Voc√™ saiu da nossa Loja Virtual.
    
Foi um prazer ajud√°-lo! Se precisar de mais alguma coisa, estamos √† disposi√ß√£o. Volte sempre! üòä`)
    setTimeout(() => {
      process.exit()
    }, 3000)
    console.log("Store Closed!")
  }
})

client.initialize()
